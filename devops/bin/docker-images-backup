#!/bin/bash

declare -a IMAGES=(
    "ravaj_web"
    "composer/composer"
    "ravaj/npm-bower-grunt-sass"
    "nginx"
    "mysql:5.6"
    "alpine"
)

mkdir -p ~/docker

load_image_if_saved()
{
    IMAGE_NAME=${1}
    BACKUP_NAME=${IMAGE_NAME/\//__}
    BACKUP_NAME=${BACKUP_NAME/:/__}

    if [[ -e ~/docker/${BACKUP_NAME}.tar ]]; then
        docker load -i ~/docker/${BACKUP_NAME}.tar
    fi
}

save_image_if_not_saved()
{
    IMAGE_NAME=${1}
    BACKUP_NAME=${IMAGE_NAME/\//__}
    BACKUP_NAME=${BACKUP_NAME/:/__}

    if [[ ! -e ~/docker/${BACKUP_NAME}.tar ]]; then
        docker save ${IMAGE_NAME} > ~/docker/${BACKUP_NAME}.tar
    fi
}

if [ "${1}" = "save" ]; then
    for image in "${IMAGES[@]}"
    do
       save_image_if_not_saved ${image}
    done
fi

if [ "${1}" = "load" ]; then
    for image in "${IMAGES[@]}"
    do
       load_image_if_saved ${image}
    done
fi